<div
  class="overlay-backdrop"
  *ngIf="open"
  (click)="close()"
  role="dialog"
  aria-modal="true"
>
  <div class="overlay-panel" (click)="$event.stopPropagation()">
    <button class="overlay-close" type="button" (click)="close()" aria-label="Chiudi">
      &times;
    </button>

    <button type="button" class="nav-btn nav-left" (click)="prev.emit()">
      <i class="bi bi-arrow-left"></i>
    </button>

    <button type="button" class="nav-btn nav-right" (click)="next.emit()">
      <i class="bi bi-arrow-right"></i>
    </button>

    <div class="overlay-content">
      <div class="overlay-cover">
        <img
          *ngIf="content?.cover"
          [src]="content.cover"
          [alt]="content?.title || 'Copertina'"
          referrerpolicy="no-referrer"
        />
      </div>

      <div class="overlay-info">
        <h2 class="overlay-title">{{ content?.title }}</h2>

        <p class="overlay-meta">
          <span class="badge">{{ content?.type }}</span>
          <span class="dot">•</span>
          <span>{{ content?.year || '—' }}</span>
          <span class="dot">•</span>
          <span>{{ content?.genre || '—' }}</span>
        </p>

        <div class="overlay-rating" *ngIf="content?.rating != null">
          <span class="rating-pill">{{ content.rating }}/10</span>
        </div>

        <p class="overlay-desc">
          {{ content?.description || 'Nessuna descrizione disponibile.' }}
        </p>

        <!-- ✅ TENDINA 1: LASCIA UNA RECENSIONE -->
        <details class="review-dropdown" (click)="$event.stopPropagation()">
          <summary class="review-summary">
            <span>Lascia una recensione</span>
            <span class="chev">▼</span>
          </summary>

          <div class="review-body">
            <div class="review-row">
              <label class="review-label">Voto (1-10)</label>
              <input class="review-input" type="number" min="1" max="10" placeholder="Es: 8" />
            </div>

            <div class="review-row">
              <label class="review-label">Commento</label>
              <textarea class="review-textarea" rows="4" placeholder="Scrivi la tua recensione..."></textarea>
            </div>

            <div class="review-actions">
              <button type="button" class="review-btn review-btn-primary">
                Invia
              </button>
              <button type="button" class="review-btn review-btn-ghost">
                Annulla
              </button>
            </div>

            <!-- Nota: quando colleghiamo la TS, il bottone "Invia" farà submitReview.emit(...) -->
          </div>
        </details>

        <!-- ✅ TENDINA 2: MOSTRA RECENSIONI -->
        <details class="review-dropdown" (click)="$event.stopPropagation()">
          <summary class="review-summary">
            <span>Mostra recensioni</span>
            <span class="review-count">({{ content?.reviews?.length || 0 }})</span>
            <span class="chev">▼</span>
          </summary>

          <div class="review-body">
            <div class="reviews-list" *ngIf="content?.reviews?.length; else noReviews">
              <div class="review-item" *ngFor="let r of content.reviews">
                <div class="review-head">
                  <span class="review-user">{{ r?.user || 'Utente' }}</span>
                  <span class="review-score">{{ r?.rating }}/10</span>
                </div>
                <div class="review-comment">{{ r?.comment }}</div>
                <div class="review-date">{{ r?.date }}</div>
              </div>
            </div>

            <ng-template #noReviews>
              <div class="no-reviews">
                Nessuna recensione disponibile.
              </div>
            </ng-template>
          </div>
        </details>

      </div>
    </div>
  </div>
</div>
