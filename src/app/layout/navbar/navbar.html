<!-- navbar.html -->
<nav class="navbar">
  <div class="navbar-container">

    <!-- LEFT -->
    <div class="left">
      <div class="logo-area" (click)="goTo('/')">
        <div class="logo-circle">
          <img src="/logoCritiverse.png" alt="CritiVerse logo" />
        </div>
        <span class="logo-text">CritiVerse</span>
      </div>
    </div>

    <!-- CENTER (DESKTOP) -->
    <div class="center desktop-only">
      <ul class="menu">

        <!-- GAMES -->
        <li class="menu-item has-dropdown">
          <a class="menu-link" routerLink="/games">
            Games <i class="bi bi-chevron-down"></i>
          </a>
          <div class="dropdown">
            <a routerLink="/games/new-releases">New Releases</a>
            <a routerLink="/games/upcoming">Upcoming</a>
            <a routerLink="/games/best-games">Best Games</a>
          </div>
        </li>

        <!-- MOVIES -->
        <li class="menu-item has-dropdown">
          <a class="menu-link" routerLink="/movies">
            Movies <i class="bi bi-chevron-down"></i>
          </a>
          <div class="dropdown">
            <a routerLink="/movies/released">Released</a>
            <a routerLink="/movies/upcoming">Upcoming</a>
            <a routerLink="/movies/best-films">Best Films</a>
          </div>
        </li>

        <!-- TV SHOWS -->
        <li class="menu-item has-dropdown">
          <a class="menu-link" routerLink="/series">
            TV Shows <i class="bi bi-chevron-down"></i>
          </a>
          <div class="dropdown">
            <a routerLink="/series/released">Released</a>
            <a routerLink="/series/upcoming">Upcoming</a>
            <a routerLink="/series/best-series">Best Series</a>
          </div>
        </li>

      </ul>
    </div>

    <!-- RIGHT -->
    <div class="right">

      <!-- DESKTOP -->
      <button
        class="search-pill desktop-only"
        type="button"
        (click)="openSearch()"
        aria-label="Open search"
      >
        <i class="bi bi-search"></i>
        <span class="search-pill-text">Search Games, Movies or Series</span>
      </button>

      <!-- ✅ PROFILE: click -> decide dove andare (me() -> /user oppure /login) -->
      <button
        style="background-color: transparent;"
        class="profile desktop-only"
        type="button"
        (click)="onProfileClick()"
        aria-label="Go to profile"
      >
        <i class="bi bi-person"></i>
      </button>

      <!-- ✅ Register si vede SOLO se NON loggato -->
      <button
        *ngIf="!isLoggedIn"
        class="register desktop-only"
        routerLink="/login"
        type="button"
      >
        Register
      </button>

      <!-- MOBILE -->
      <button
        class="search-icon mobile-only"
        type="button"
        (click)="openSearch()"
        aria-label="Search"
      >
        <i class="bi bi-search"></i>
      </button>

      <button
        class="hamburger mobile-only"
        type="button"
        (click)="toggleMenu()"
        aria-label="Open menu"
      >
        <i class="bi bi-list"></i>
      </button>

    </div>

    <!-- MOBILE MENU -->
    <div class="mobile-menu" *ngIf="isMenuOpen">

      <!-- GAMES -->
      <button class="mobile-accordion" type="button" (click)="toggleMobileSection('games')">
        <span>Games</span>
        <i class="bi" [ngClass]="mobileOpen === 'games' ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
      </button>
      <div class="mobile-submenu" *ngIf="mobileOpen === 'games'">
        <a routerLink="/games/new-releases" (click)="closeMenu()">New Releases</a>
        <a routerLink="/games/upcoming" (click)="closeMenu()">Upcoming</a>
        <a routerLink="/games/best-games" (click)="closeMenu()">Best Games</a>
      </div>

      <!-- MOVIES -->
      <button class="mobile-accordion" type="button" (click)="toggleMobileSection('movies')">
        <span>Movies</span>
        <i class="bi" [ngClass]="mobileOpen === 'movies' ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
      </button>
      <div class="mobile-submenu" *ngIf="mobileOpen === 'movies'">
        <a routerLink="/movies/released" (click)="closeMenu()">Released</a>
        <a routerLink="/movies/upcoming" (click)="closeMenu()">Upcoming</a>
        <a routerLink="/movies/best-films" (click)="closeMenu()">Best Films</a>
      </div>

      <!-- TV SHOWS -->
      <button class="mobile-accordion" type="button" (click)="toggleMobileSection('series')">
        <span>TV Shows</span>
        <i class="bi" [ngClass]="mobileOpen === 'series' ? 'bi-chevron-up' : 'bi-chevron-down'"></i>
      </button>
      <div class="mobile-submenu" *ngIf="mobileOpen === 'series'">
        <a routerLink="/series/released" (click)="closeMenu()">Released</a>
        <a routerLink="/series/upcoming" (click)="closeMenu()">Upcoming</a>
        <a routerLink="/series/best-series" (click)="closeMenu()">Best Series</a>
      </div>

      <!-- ACCOUNT -->
      <div class="mobile-divider"></div>

      <!-- ✅ PROFILE MOBILE: click -> decide dove andare -->
      <button class="mobile-link" type="button" (click)="onProfileClick()">
        <i class="bi bi-person"></i>
        <span>Profile</span>
      </button>

      <!-- ✅ Register MOBILE solo se non loggato -->
      <button
        *ngIf="!isLoggedIn"
        class="mobile-register"
        type="button"
        routerLink="/login"
        (click)="closeMenu()"
      >
        Register
      </button>

    </div>
  </div>
</nav>

<!-- SEARCH OVERLAY -->
<div class="search-overlay" *ngIf="isSearchOpen" (click)="closeSearch()">
  <div class="search-modal" (click)="$event.stopPropagation()">

    <div class="search-modal-header">
      <div class="search-title">
        <i class="bi bi-search"></i>
        <span>Search</span>
      </div>

      <button class="close-btn" type="button" (click)="closeSearch()" aria-label="Close">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="search-input-wrap">
      <i class="bi bi-search"></i>
      <input
        #overlaySearchInput
        type="text"
        [(ngModel)]="searchQuery"
        placeholder="Search games, movies, series..."
        (keydown.escape)="closeSearch()"
      />
    </div>

    <!-- RESULTS -->
    <ng-container *ngIf="groupedResults.length; else noResultsTpl">
      <div class="search-results">
        <div class="search-list">

          <ng-container *ngFor="let g of groupedResults">
            <div class="sr-divider"></div>

            <button
              class="sr-row"
              type="button"
              *ngFor="let it of g.items"
              (click)="openDetailsFromSearch(it)"
            >
              <img class="sr-thumb" [src]="it.thumbUrl" [alt]="it.title" />

              <div class="sr-main">
                <div class="sr-title">{{ it.title }}</div>
                <div class="sr-meta">
                  <span class="sr-tag">{{ g.label }}</span>
                  <span class="sr-info">ID: {{ it.id }}</span>
                </div>
              </div>

              <div class="sr-score">{{ it.score }}</div>
            </button>

          </ng-container>

        </div>
      </div>
    </ng-container>

    <ng-template #noResultsTpl>
      <div class="search-results">
        <div class="no-results" *ngIf="searchQuery.trim().length">
          Nessun risultato per “{{ searchQuery }}”.
        </div>
        <div class="no-results" *ngIf="!searchQuery.trim().length">
          Inizia a scrivere per cercare.
        </div>
      </div>
    </ng-template>

  </div>
</div>
