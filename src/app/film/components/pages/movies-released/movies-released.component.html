<div class="page-container">
  <header class="page-header">
    <h1 class="page-title">
      <ng-container *ngIf="isDefaultView; else filteredTitle">
        I film appena usciti ti aspettano!
      </ng-container>
      <ng-template #filteredTitle>
        Tutti i film del – {{ selectedYear }}
      </ng-template>
    </h1>

    <p class="page-subtitle">
      <ng-container *ngIf="isDefaultView; else filteredSubtitle">
        Scopri le ultime uscite cinematografiche!
      </ng-container>
      <ng-template #filteredSubtitle>
        Film pubblicati nel {{ selectedYear }}.
      </ng-template>
    </p>
  </header>

  <div class="page-content">

    <!-- FILTRI -->
    <aside class="filters">

      <div class="filters-header">Filtri</div>

      <!-- ANNO -->
      <div class="filter-header-row">
        <h4 class="filter-title">Anno di rilascio</h4>
        <button
          class="filter-reset"
          *ngIf="isYearFilterActive"
          (click)="resetYearFilter()">
          RESET
        </button>
      </div>

      <div class="year-slider" *ngIf="selectedYear !== undefined">
        <div
          class="year-tooltip"
          *ngIf="isDraggingYear"
          [style.left.%]="((selectedYear - minYear) / (maxYear - minYear)) * 100">
          {{ selectedYear }}
        </div>

        <input
          type="range"
          [min]="minYear"
          [max]="maxYear"
          [ngModel]="selectedYear"
          (ngModelChange)="changeYear($event)"
          (mousedown)="onYearDragStart()"
          (mouseup)="onYearDragEnd()"
          (mouseleave)="onYearDragEnd()"
        />

        <div class="year-range">
          <span>{{ minYear }}</span>
          <span>{{ maxYear }}</span>
        </div>
      </div>

      <!-- GENRES -->
      <div class="filter-block">
        <div class="filter-header-row">
          <h4 class="filter-title">Generi</h4>
          <button
            class="filter-reset"
            *ngIf="(selectedGenres$ | async)?.size"
            (click)="resetGenreFilter()">
            RESET
          </button>
        </div>

        <label *ngFor="let genre of availableGenres">
          <input
            type="checkbox"
            #cb
            [checked]="(selectedGenres$ | async)?.has(genre)"
            (change)="toggleGenre(genre, cb.checked)" />
          {{ genre }}
        </label>
      </div>

    </aside>

    <!-- RISULTATI -->
    <section class="results">

      <ng-container *ngIf="films$ | async as films">

        <div class="results-header">

          <span class="results-count">
            {{ films.length }} risultati
          </span>

          <div class="sort-controls">

            <select
              class="sort-select"
              [ngModel]="sortValue"
              (ngModelChange)="changeSort($event)">
              <option value="date">Anno di uscita</option>
              <option value="score">Criti-Score</option>
            </select>

            <div class="sort-arrows">

              <div class="arrow-wrapper">
                <button
                  class="arrow-btn"
                  [class.active]="sortDirection === 'asc'"
                  (click)="setSortDirection('asc')">
                  ↑
                </button>

                <div class="arrow-tooltip tooltip-top">
                  {{ sortValue === 'date' ? 'Anno' : 'Criti-Score' }} – Crescente
                </div>
              </div>

              <div class="arrow-wrapper">
                <button
                  class="arrow-btn"
                  [class.active]="sortDirection === 'desc'"
                  (click)="setSortDirection('desc')">
                  ↓
                </button>

                <div class="arrow-tooltip tooltip-bottom">
                  {{ sortValue === 'date' ? 'Anno' : 'Criti-Score' }} – Decrescente
                </div>
              </div>

            </div>
          </div>

        </div>

        <!-- GRID -->
        <div class="games-grid" *ngIf="films.length > 0">
          <app-film-card
            *ngFor="let film of films"
            [film]="film"
            [mode]="sortValue">
          </app-film-card>
        </div>

        <!-- NO RESULTS -->
        <p *ngIf="films.length === 0" class="no-results">
          Nessun film trovato.
        </p>

        <!-- PAGINAZIONE -->
        <div class="pagination" *ngIf="pages.length > 1">
          <button
            *ngFor="let page of pages"
            class="page-btn"
            [class.active]="page === (currentPage$ | async)"
            (click)="changePage(page)">
            {{ page }}
          </button>
        </div>

      </ng-container>

    </section>
  </div>
</div>

